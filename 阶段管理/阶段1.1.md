# 阶段1.1


### 1. 基础移动系统
#### 角色移动
- 左右移动
  - 基础速度控制
  - 加速度和减速度
  - 移动动画状态切换
  - 支持方向键和WASD控制
- 跳跃机制
  - 基础跳跃
  - 二段跳
  - 跳跃高度控制
  - 跳跃动画
  - 支持上方向键和W键跳跃
- 碰撞检测
  - 地面碰撞
  - 墙壁碰撞
  - 平台边缘检测
  - 无弹性碰撞

## 项目构建

### 1. 技术栈
- 游戏引擎：Phaser 3.x
- 开发语言：TypeScript
- 构建工具：Webpack
- 开发服务器：Webpack Dev Server

### 2. 项目结构
```
project/
├── src/
│   ├── entities/
│   │   └── Player.ts      # 玩家类
│   ├── scenes/
│   │   └── GameScene.ts   # 游戏场景
│   ├── index.ts           # 入口文件
│   └── index.html         # HTML模板
├── package.json           # 项目配置
├── tsconfig.json          # TypeScript配置
└── webpack.config.js      # Webpack配置
```

### 3. 核心实现

#### 3.1 游戏配置 (index.ts)
```typescript
const config: Phaser.Types.Core.GameConfig = {
  type: Phaser.AUTO,
  width: 800,
  height: 600,
  physics: {
    default: 'arcade',
    arcade: {
      gravity: { y: 300 },
      debug: true
    }
  },
  scene: GameScene
};
```

#### 3.2 玩家类 (Player.ts)
```typescript
export class Player extends Phaser.Physics.Arcade.Sprite {
  private cursors: Phaser.Types.Input.Keyboard.CursorKeys;
  private wasdKeys: {
    W: Phaser.Input.Keyboard.Key;
    A: Phaser.Input.Keyboard.Key;
    S: Phaser.Input.Keyboard.Key;
    D: Phaser.Input.Keyboard.Key;
  };
  private jumpVelocity: number = -400;
  private moveSpeed: number = 160;

  constructor(scene: Phaser.Scene, x: number, y: number) {
    super(scene, x, y, 'player');
    scene.physics.add.existing(this);
    this.setBounce(0);
    this.setCollideWorldBounds(true);
    
    // 获取键盘控制
    this.cursors = scene.input.keyboard.createCursorKeys();
    this.wasdKeys = scene.input.keyboard.addKeys({
      W: Phaser.Input.Keyboard.KeyCodes.W,
      A: Phaser.Input.Keyboard.KeyCodes.A,
      S: Phaser.Input.Keyboard.KeyCodes.S,
      D: Phaser.Input.Keyboard.KeyCodes.D
    }) as any;
  }

  update() {
    // 左右移动 (同时支持方向键和AD键)
    const isLeftPressed = this.cursors.left.isDown || this.wasdKeys.A.isDown;
    const isRightPressed = this.cursors.right.isDown || this.wasdKeys.D.isDown;

    if (isLeftPressed) {
      this.setVelocityX(-this.moveSpeed);
    } else if (isRightPressed) {
      this.setVelocityX(this.moveSpeed);
    } else {
      this.setVelocityX(0);
    }

    // 跳跃 (同时支持上方向键和W键)
    const isJumpPressed = this.cursors.up.isDown || this.wasdKeys.W.isDown;
    if (isJumpPressed && this.body.touching.down) {
      this.setVelocityY(this.jumpVelocity);
    }
  }
}
```

#### 3.3 游戏场景 (GameScene.ts)
```typescript
export class GameScene extends Phaser.Scene {
  private player!: Player;
  private platforms!: Phaser.Physics.Arcade.StaticGroup;

  create() {
    // 创建平台
    this.platforms = this.physics.add.staticGroup();
    
    // 创建地面和其他平台
    const ground = this.add.rectangle(400, 568, 800, 32, 0x00ff00);
    this.platforms.add(ground);
    this.physics.add.existing(ground, true);

    // 创建玩家
    this.player = new Player(this, 100, 450);
    this.add.existing(this.player);

    // 设置碰撞
    this.physics.add.collider(this.player, this.platforms);
  }
}
```

### 4. 当前实现的功能
1. 基础移动系统
   - 左右移动（支持方向键和WASD）
   - 基础跳跃（支持上方向键和W键）
   - 与平台和世界边界的碰撞检测
   - 无弹性碰撞效果

2. 物理系统
   - 重力系统
   - 碰撞系统
   - 无弹跳效果

3. 临时图形
   - 使用 Phaser 图形 API 创建临时贴图
   - 红色方块代表玩家
   - 绿色矩形代表平台

### 5. 待实现功能
1. 移动系统优化
   - 添加加速度和减速度
   - 实现二段跳
   - 优化跳跃手感

2. 动画系统
   - 添加移动动画
   - 添加跳跃动画
   - 实现动画状态机

3. 平台交互
   - 添加更多平台类型
   - 实现平台边缘检测
   - 添加平台特效
  